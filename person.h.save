#ifndef __PERSON_H__
#define __PERSON_H__

#include "TXLib.h" //подключение основной библиотеки


class Person
{
private:
    HDC photo; //указатель на загруженную картинку

    int x; //положение спрайта на экране по ох
    int y; //положение спрайта на экране по оу
    int x1; //положение спрайта на источнике по ох
    int y1; //положение спрайта на источнике по оу
    int width; //длина одной части спрайта
    int height; // высота одной части спрайта

    double scalex; //сжатие или растяжение спрайта по оси ох
    double scaley; //сжатие или растяжение спрайта по оси оу

    COLORREF color; //цвет который стираеться со спрайта

    int xa; //расстояние между спрайтами по горизонтали
    int ya; //расстояние между спрайтами по вертикали
    
    Karta* karta;

    //команды для персонажа

    int v; //скорость персонажа

    char d; //стрелка в сторону которого двигаеться персонаж ->
    char a; //стрелка в сторону которого двигаеться персонаж <-
    char w; //стрелка в сторону которого двигаеться персонаж (вверх)
    char s; //стрелка в сторону которого двигаеться персонаж (вниз)

    int k;  //положение персонажа в строке на массиве карты
    int n;  //положение персонажа в столбцу на массиве карты

    int pers[10][10];  //массив который принимает данные другого массива
    HDC photo1
public:
    Person(): //конструктор
    photo(txLoadImage("fnafb.bmp")),photo1(txLoadImage("karta.bmp"),x(370),y(370),x1(41),y1(6),width(134),height(197),scalex(0.3),scaley(0.3),color(TX_BLACK),xa(70),ya(8),v(5),d(VK_RIGHT),a(VK_LEFT),w(VK_UP),s(VK_DOWN),n(7),k(7)
    {
        if(!photo)
        {
            txMessageBox("Не найден файл с персонажем","Ошибка #3");
            exit(0);
        }
    }

    ~Person() //деструктор
    {
        txDeleteDC(photo); //удаление картинки из памяти
    }

    void init_karta(Karta* a) //функция для создания указателя
    {
        karta=a;
    }

    void draw() //функция отрисовки
    {
        Win32::TransparentBlt (txDC(), x, y, width*scalex, height*scaley, photo, x1, y1, width, height, color); //рисование
    }

    void up(int a, double b) //функция изменения положения вверх
    {
        y1=600;
        x1+=width+xa; //движение по  загруженной картинке для изменения положения рук у персонажа
        y-=a*b; //движение по карте
        if(x1>=570) //возвращение назад по загруженной картинке
        {
            x1=41;
        }
    }

    void left(int a, double b) //движение влево
    {
        y1=205;
        x1-=width+xa; //движение по  загруженной картинке для изменения положения рук у персонажа
        x-=a*b; //движение по карте
        if(x1<=29) //возвращение назад по загруженной картинке
        {
            x1=427;
        }
    }

    void down(int a, double b) //движение вниз
    {
        y1=6;
        x1+=width+xa;//движение по  загруженной картинке для изменения положения рук у персонажа
        y+=a*b;//движение по карте
        if(x1>=570) //возвращение назад по загруженной картинке
        {
            x1=41;
        }
    }

    void right(int a, double b) //движение вправо
    {
        y1=405;
        x1+=width+xa;//движение по  загруженной картинке для изменения положения рук у персонажа
        x+=a*b;//движение по карте
        if(x1>=570)//возвращение назад по загруженной картинке
        {
            x1=41;
        }

    }

    void update() //отрисовка и обновление положения
    {
        if(GetAsyncKeyState(VK_LBUTTON))
            printf("%d",pers[n-1][k]);
        if(GetAsyncKeyState(VK_RBUTTON))
            printf("%d",pers[n+1][k]);

        if(GetAsyncKeyState(s) && pers[n+1][k]<0 && pers[n+1][k]!=-3) //проверка на нажание кнопки и на границы карты
        {
            Win32::TransparentBlt (txDC(), x, y, karta->get_width()*karta->get_scalex(),karta->get_height()*karta->get_scalex(), photo1, 980, 650, karta->get_width(), karta->get_height(), TX_WHITE); //рисование
            down(karta->get_height(),karta->get_scalex()); //вызов функции для изменение положение
            n+=1; //движение по массиву
            
            if(pers[n-1][k]!=-2)
                pers[n-1][k]=-3;
        }
        else if(GetAsyncKeyState(d) && pers[n][k+1]<0 && pers[n][k+1]!=-3)//проверка на нажание кнопки и на границы карты
        {
            right(karta->get_height(),karta->get_scalex());//вызов функции для изменение положение
            k+=1;//движение по массиву
            if(pers[n][k-1]!=-2)
                pers[n][k-1]=-3;
        }
        else if(GetAsyncKeyState(w) && pers[n-1][k]<0 && pers[n-1][k]!=-3)//проверка на нажание кнопки и на границы карты
        {
            up(karta->get_height(),karta->get_scalex());//вызов функции для изменение положение
            n-=1;//движение по массиву
            if(pers[n+1][k]!=-2)
                pers[n+1][k]=-3;
        }
        else if(GetAsyncKeyState(a) && pers[n][k-1]<0 && pers[n][k-1]!=-3)//проверка на нажание кнопки и на границы карты
        {
            left(karta->get_height(),karta->get_scalex());//вызов функции для изменение положение
            k-=1;//движение по массиву
            if(pers[n][k+1]!=-2)
                pers[n][k+1]=-3;
        }
    }

    int init_pers()
    {
        FILE* f;
        f = fopen("karta.txt", "r"); //открытие файла karta.txt
        if (f==NULL) //проверка на наличие файлы с матрицей
        {
            txMessageBox("Не найден файл с картой","Ошибка #1");
            return 1;
        }
        fscanf(f,"\n");
        for (int i = 0; i < 10; i++)
        {
            for(int j = 0; j < 10; j++)
            {
                fscanf(f, "%d", &pers[i][j]); //считывание самого массива
            }
            fscanf(f,"\n");
        }
        fclose(f); //закрытие файла

        return 0;
    }


};
#endif
